#!@bash@/bin/bash

# Exit early if screensave is already running
pgrep -f org.omarchy.screensaver && exit 0

# Allow screensaver to be turned off but also force started
if [[ -f ~/.local/state/omarchy/toggles/screensaver-off ]] && [[ $1 != "force" ]]; then
  exit 1
fi

# Silently quit Walker on overlay
@walker@/bin/walker --close

focused=$(@hyprland@/bin/hyprctl monitors -j | @jq@/bin/jq -r '.[] | select(.focused == true).name')
terminal=$(@xdg-terminal-exec@/bin/xdg-terminal-exec --print-id)

for m in $(@hyprland@/bin/hyprctl monitors -j | @jq@/bin/jq -r '.[] | .name'); do
  @hyprland@/bin/hyprctl dispatch focusmonitor $m

  case $terminal in
  *Alacritty*)
    @hyprland@/bin/hyprctl dispatch exec -- \
      alacritty --class=org.omarchy.screensaver \
      --config-file @alacrittyConf@ \
      -e omarchy-cmd-screensaver
    ;;
  *ghostty*)
    @hyprland@/bin/hyprctl dispatch exec -- \
      ghostty --class=org.omarchy.screensaver \
      --config-file=@ghosttyConf@ \
      --font-size=18 \
      -e omarchy-cmd-screensaver
    ;;
  *kitty*)
    @hyprland@/bin/hyprctl dispatch exec -- \
      kitty --class=org.omarchy.screensaver \
      --override font_size=18 \
      --override window_padding_width=0 \
      -e omarchy-cmd-screensaver
    ;;
  *)
    @libnotify@/bin/notify-send "âœ‹  Screensaver only runs in Alacritty, Ghostty, or Kitty"
    ;;
  esac
done

hyprctl dispatch focusmonitor $focused
