#!@bash@/bin/bash

# Default temperature values
ON_TEMP=4000
OFF_TEMP=6000

# Ensure hyprsunset is running
if ! pgrep -x hyprsunset; then
  setsid uwsm-app -- @hyprsunset@/bin/hyprsunset &
  sleep 1 # Give it time to register
fi

# Query the current temperature
CURRENT_TEMP=$(@hyprland@/bin/hyprctl hyprsunset temperature 2>/dev/null | @gnugrep@/bin/grep -oE '[0-9]+')

restart_nightlighted_waybar() {
  if @gnugrep@/bin/grep -q "custom/nightlight" ~/.config/waybar/config.jsonc; then
    omarchy-restart-waybar # restart waybar in case user has waybar module for hyprsunset
  fi
}

if [[ "$CURRENT_TEMP" == "$OFF_TEMP" ]]; then
  @hyprland@/bin/hyprctl hyprsunset temperature $ON_TEMP
  @libnotify@/bin/notify-send "  Nightlight screen temperature"
  restart_nightlighted_waybar
else
  @hyprland@/bin/hyprctl hyprsunset temperature $OFF_TEMP
  @libnotify@/bin/notify-send "   Daylight screen temperature"
  restart_nightlighted_waybar
fi
